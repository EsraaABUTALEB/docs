name: Sync Swagger Specs

on:
  # Trigger on every push to main
  push:
    branches:
      - main
  # Run daily at 6:00 AM UTC
  schedule:
    - cron: "0 6 * * *"
  # Allow manual trigger from the GitHub Actions UI
  workflow_dispatch:

jobs:
  sync-specs:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Fetch OpenAPI specs from dev environments
        run: |
          chmod +x scripts/sync-swagger.sh
          bash scripts/sync-swagger.sh

      - name: Commit updated specs (if changed)
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "chore: sync OpenAPI specs from dev [skip ci]"
          file_pattern: "openapi/*.json"

      # Mintlify automatically redeploys on every push to main via its GitHub App.
      # No additional deploy step is needed.
